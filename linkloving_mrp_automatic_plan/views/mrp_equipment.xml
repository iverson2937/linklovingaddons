<openerp>
    <data>
        <record id="action_form_plan_mo_wizard" model="ir.actions.act_window">
            <field name="name">排产</field>
            <field name="res_model">plan.mo.wizard</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>
        <!-- Inherit Form View to Modify it -->
        <record id="mrp_process_form_inherit" model="ir.ui.view">
            <field name="name">mrp.process.form.inherit</field>
            <field name="model">mrp.process</field>
            <field name="inherit_id" ref="linkloving_process.mrp_process_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='company_id']" position="before">
                    <field name="work_type_id"/>
                    <field name="hourly_wage"/>
                </xpath>
                <xpath expr="//group" position="after">
                    <!-- Add your fields or attributes here -->
                    <notebook>
                        <page string="产线">
                            <field name="production_line_ids" context="{'default_process_id': active_id}">
                                <tree>
                                    <field name="name"/>
                                    <field name="employee_id"/>
                                    <field name="euiqpment_names"/>
                                    <field name="line_employee_names"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </xpath>

            </field>
        </record>

        <record id="mrp_production_line_tree" model="ir.ui.view">
            <field name="name">mrp.production.line.tree</field>
            <field name="model">mrp.production.line</field>
            <field name="arch" type="xml">
                <tree string="产线">
                    <field name="name"/>
                    <field name="process_id"/>
                    <field name="employee_id"/>
                </tree>
            </field>
        </record>

        <record id="mrp_process_equipment_tree" model="ir.ui.view">
            <field name="name">mrp.process.equipment.tree</field>
            <field name="model">mrp.process.equipment</field>
            <field name="arch" type="xml">
                <tree string="设备">
                    <field name="name"/>
                    <field name="production_line_id" string="所属产线"/>
                    <field name="process_id"/>
                    <field name="employee_id"/>
                </tree>
            </field>
        </record>
        <record id="mrp_process_equipment_form" model="ir.ui.view">
            <field name="name">mrp.process.equipment</field>
            <field name="model">mrp.process.equipment</field>
            <field name="arch" type="xml">
                <form string="设备">
                    <sheet>
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="process_id"/>
                            </group>
                            <group>
                                <field name="employee_id"/>
                                <field name="production_line_id" string="所属产线"/>
                            </group>

                        </group>
                        <!--<notebook>-->
                        <!--<page string="设备">-->
                        <!--<field name="equipment_ids"/>-->
                        <!--</page>-->
                        <!--</notebook>-->
                    </sheet>
                </form>
            </field>
        </record>

        <record id="work_type_form" model="ir.ui.view">
            <field name="name">work.type.form</field>
            <field name="model">work.type</field>
            <field name="arch" type="xml">
                <form string="工种">
                    <sheet>
                        <group>
                            <field name="name"/>
                            <field name="hourly_wage"/>
                        </group>
                        <group>
                            <field name="description"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="mrp_production_line_form" model="ir.ui.view">
            <field name="name">mrp.production.line</field>
            <field name="model">mrp.production.line</field>
            <field name="arch" type="xml">
                <form string="产线">
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="toggle_active" type="object"
                                    class="oe_stat_button" icon="fa-archive">
                                <field name="active" widget="boolean_button"
                                       options='{"terminology": "active"}'/>
                            </button>
                        </div>
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="process_id"/>
                                <field name="employee_id"/>
                                <field name="sequence"/>
                            </group>

                        </group>
                        <notebook>
                            <page string="设备">
                                <field name="equipment_ids"
                                       context="{'default_production_line_id': active_id}"/>
                            </page>
                            <!--<page string="人员">-->
                                <!--<field name="line_employee_ids" widget="many2many"/>-->
                            <!--</page>-->
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="action_mrp_production_line" model="ir.actions.act_window">
            <field name="name">mrp.production.line</field>
            <field name="res_model">mrp.production.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="menu_mrp_production_line_config" name="产线" parent="mrp.menu_mrp_configuration" sequence="31"
                  action="action_mrp_production_line"/>

        <record id="action_mrp_equipment" model="ir.actions.act_window">
            <field name="name">mrp.process.equipment</field>
            <field name="res_model">mrp.process.equipment</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="menu_mrp_equipment_config" name="设备" parent="mrp.menu_mrp_configuration" sequence="32"
                  action="action_mrp_equipment"/>

        <record id="work_type_tree" model="ir.ui.view">
            <field name="name">work.type.tree</field>
            <field name="model">work.type</field>
            <field name="arch" type="xml">
                <tree string="工种">
                    <field name="name"/>
                    <field name="hourly_wage"/>
                    <field name="description"/>
                </tree>
            </field>
        </record>
        <record id="action_mrp_work_type" model="ir.actions.act_window">
            <field name="name">work.type</field>
            <field name="res_model">work.type</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="menu_mrp_work_type_config" name="工种" parent="mrp.menu_mrp_configuration" sequence="33"
                  action="action_mrp_work_type"/>


        <!--<record model="ir.actions.client" id="test_pc_action">-->
        <!--<field name="name">linkloving_mrp_automatic_plan window</field>-->
        <!--<field name="tag">arrange_production</field>-->
        <!--</record>-->

        <!--<menuitem id="test_pc"-->
        <!--name="生产排产"-->
        <!--action="test_pc_action"-->
        <!--parent="mrp.menu_mrp_manufacturing"-->
        <!--sequence="13"/>-->
        <!-- Inherit Form View to Modify it -->
        <record id="mrp_bom_from_view_inherit" model="ir.ui.view">
            <field name="name">mrp.bom.form.inherit</field>
            <field name="model">mrp.bom</field>
            <field name="inherit_id" ref="linkloving_process.mrp_bom_form_view"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='prepare_time']" position="after">
                    <field name="produce_speed_factor"/>
                    <field name="theory_factor"/>
                    <field name="piecework_unit_price"/>
                </xpath>
                <xpath expr="//field[@name='cost']" position="after">
                    <label for="amount_of_producer"/>
                    <div class="o_row">
                        <field name="amount_of_producer" required="1"/>
                        <span>个人/台设备, 每小时产出</span>
                        <field name="produced_speed_per_hour" required="1" string="每小时产出数量"/>
                        <span>个</span>
                    </div>
                        <field name="produced_speed_per_sec_new" readonly="1" string="换算后的生产速度(秒/每个)"/>
                    <field name="produced_cost"/>
                </xpath>

            </field>
        </record>

        <record id="mrp_production_paichan_form_view" model="ir.ui.view">
            <field name="name">mrp.production.form</field>
            <field name="model">mrp.production</field>
            <field name="priority">50</field>
            <field name="arch" type="xml">
                <form string="Manufacturing Orders">
                    <header>
                        <button name="button_plan"
                                attrs="{'invisible': ['|', ('state', '!=', 'confirmed'), ('routing_id', '=', False)]}"
                                type="object" string="Create Workorders" class="oe_highlight"/>
                        <button name="button_action_confirm_draft" class="oe_highlight"
                                attrs="{'invisible': [('state', 'not in', 'draft')]}" type="object"
                                groups="linkloving_mrp_extend.group_charge_produce" string="确认需求"/>

                        <!--<button type="action"-->
                        <!--name="%(action_form_plan_mo_wizard)d"-->
                        <!--class="oe_highlight"-->
                        <!--attrs="{'invisible': [('state', 'not in', ('confirmed', 'draft'))]}"-->
                        <!--context="{'default_production_id': active_id,-->
                        <!--'default_process_id': process_id,-->
                        <!--'default_production_line_id': production_line_id,-->
                        <!--'default_in_charge_id': in_charge_id,-->
                        <!--'default_supplier_id': supplier_id,-->
                        <!--'default_product_qty': product_qty}"-->
                        <!--string="开始排产"/>-->
                        <button type="formview_dialog"
                                name="get_formview"
                                class="oe_highlight"
                                attrs="{'invisible': [('state', 'not in', ('confirmed', 'draft'))]}"
                                context="{'default_production_id': active_id,
                                'production_id': active_id,
                                'default_process_id': process_id,
                                'default_production_line_id': production_line_id,
                                'default_in_charge_id': in_charge_id,
                                'default_planned_start_backup': planned_start_backup,
                                'default_product_qty': product_qty}"
                                string="开始排产"/>
                        <button name="action_cancel_plan" type="object" string="取消排产"
                                attrs="{'invisible': [('state', 'not in', ('waiting_material'))]}"
                        />

                        <button name="action_cancel" type="object" string="取消订单"
                                attrs="{'invisible': [('state', 'not in', ('confirmed', 'draft'))]}"
                                confirm="确定取消订单?"
                        />

                        <field name="state" widget="statusbar"
                               statusbar_visible="draft,confirmed,waiting_material,prepare_material_ing,finish_prepare_material,already_picking,progress,waiting_quality_inspection,quality_inspection_ing,waiting_post_inventory,done"/>

                    </header>
                    <sheet>
                        <field name="post_visible" invisible="1"/>
                        <!--<div class="oe_button_box" name="button_box">-->
                        <!--<button name="372" type="action" attrs="{'invisible': [('workorder_count', '=', 0)]}" class="oe_stat_button" icon="fa-play-circle-o">-->
                        <!--<div class="o_form_field o_stat_info">-->
                        <!--<span class="o_stat_value"><field name="workorder_done_count" widget="statinfo" nolabel="1"/> / <field name="workorder_count" widget="statinfo" nolabel="1"/></span>-->
                        <!--<span class="o_stat_text">Work Orders</span>-->
                        <!--</div>-->
                        <!--</button>-->
                        <!--<button name="368" type="action" string="Inventory Moves" class="oe_stat_button" icon="fa-arrows-v" attrs="{'invisible': [('state', 'not in', ('progress', 'cancel', 'done'))]}"/>-->
                        <!--<button class="oe_stat_button" name="action_see_move_scrap" type="object" icon="fa-arrows-v" attrs="{'invisible': [('scrap_count', '=', 0)]}">-->
                        <!--<div class="o_form_field o_stat_info">-->
                        <!--<span class="o_stat_value"><field name="scrap_count"/></span>-->
                        <!--<span class="o_stat_text">Scraps</span>-->
                        <!--</div>-->
                        <!--</button>-->
                        <!--</div>-->
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Manufacturing Reference" nolabel="1"/>
                            </h1>
                            <field name="is_bom_update" invisible="1"/>
                            <label style="color:red;" string="BOM已发生变化"
                                   attrs="{'invisible': [('is_bom_update', '=', False)]}"/>

                        </div>
                        <group>
                            <group>
                                <field name="has_moves" invisible="1"/>
                                <field name="check_to_done" invisible="1"/>
                                <field name="alia_name"/>
                                <field name="product_id" attrs="{'readonly': [('has_moves', '=', True)]}"
                                       domain="[('bom_ids', '!=', False)]"/>
                                <field name="product_tmpl_id" invisible="1"/>
                                <label for="product_qty"/>
                                <div class="o_row">
                                    <field name="product_qty" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                                    <field name="product_uom_id" options="{'no_open':True,'no_create':True}"
                                           groups="product.group_uom" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                                    <button type="formview_dialog"
                                            name="get_change_prod_qty_formview"
                                            string="更新数量"
                                            states="confirmed,draft"
                                            class="oe_highlight"
                                            attrs="{'invisible': [('state','!=','confirmed,draft')]}"
                                            context="{'default_mo_id':active_id,'default_product_qty': product_qty}"
                                    />
                                </div>
                                <field name="process_id" options="{'no_create':True}" string="工序" required="1"
                                       readonly="1"/>
                                <field name="production_line_id" domain="[('process_id', '=', process_id)]"
                                       readonly="1"/>
                                <field name="in_charge_id" options="{'no_create':True}" readonly="1" string="负责人"/>
                                <field name="supplier_id" readonly="1"/>
                                <field name="planned_start_backup"/>

                                <field name="routing_id" groups="mrp.group_mrp_routings"/>
                                <field name="date_planned_start" readonly="1" string="开始"/>
                                <field name="date_planned_finished" readonly="1" string="结束"/>
                            </group>
                            <group>
                                <field name="bom_id"
                                       domain="['&amp;', '|',('product_id','=',product_id),'&amp;',
                                   ('product_tmpl_id.product_variant_ids','=',product_id),
                                   ('product_id','=',False),
                                   ('type', '=', 'normal')]"
                                       context="{'default_product_tmpl_id': product_tmpl_id}"
                                       required="1"
                                       attrs="{'readonly': [('has_moves', '=', True)]}"/>
                                <field name="sale_order_handle_date"/>
                                <field name="origin"/>
                                <field name="production_order_type"/>
                                <field name="mo_type" widget="radio" string="类型" invisible="1"/>
                                <field name="unit_price" string="单价/委外加工单价"
                                       attrs="{'invisible':[('mo_type', '==', 'time')],'readonly':[('state', '!=', 'confirmed')]}"/>
                                <!--<field name="hour_price"-->
                                <!--attrs="{'invisible':[('mo_type', '==', 'unit')],'readonly':[('state', '!=', 'confirmed')]}"/>-->
                                <field name="sale_remark" readonly="1"/>
                                <field name="remark"/>
                                <field name="factory_remark"/>
                                <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"
                                       attrs="{'readonly': [('has_moves', '=', True)]}"/>
                            </group>
                            <field name="output_rate"/>
                        </group>

                        <notebook>
                            <page string="消耗的物料">
                                <field name="sim_stock_move_lines" string="消耗的物料">
                                    <tree editable="bottom"
                                          delete="0"
                                          decoration-success="remaining_qty==0"
                                          decoration-danger="qty_available&lt;remaining_qty"
                                          create="0">
                                        <field name="product_id" string="产品" options="{'no_create':True}"/>
                                        <field name="product_uom_qty" string="需求数量"/>
                                        <field name="suggest_qty" string="建议数量"/>
                                        <field name="qty_available" string="库存"/>
                                        <field name="remaining_qty"/>
                                        <field name="quantity_done" string="备料数量"/>
                                        <field name="return_qty" readonly="1" string="退料数量"/>
                                        <field name="virtual_available" string="预测数量"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="产成品">
                                <field name="move_finished_ids" options="{'reload_on_button': True}"
                                       context="{'default_location_id': location_src_id, 'default_location_dest_id': location_dest_id}">
                                    <tree editable="bottom" delete="0" default_order="is_done desc,sequence"
                                          decoration-muted="is_done"
                                          decoration-warning="quantity_done&gt;product_uom_qty"
                                          decoration-success="quantity_done==product_uom_qty" create="0">
                                        <field name="product_id" required="1"/>
                                        <field name="product_uom" groups="product.group_uom"/>
                                        <field name="is_done" invisible="1"/>
                                        <field name="sequence" invisible="1"/>
                                        <field name="has_tracking" invisible="1"/>
                                        <field name="location_id" domain="[('id', 'child_of', parent.location_id)]"
                                               invisible="1"/>
                                        <field name="location_dest_id"
                                               domain="[('id', 'child_of', parent.location_dest_id)]" invisible="1"/>
                                        <field name="state" invisible="1"/>
                                        <field name="product_uom_qty" readonly="1"
                                               attrs="{'required': [('product_id', '!=', False)]}" string="To Produce"/>
                                        <field name="quantity_done"
                                               attrs="{'readonly': ['|', ('is_done', '=', True), ('has_tracking', 'in', ['lot','serial'])]}"
                                               string="Produced"/>
                                        <button name="split_move_lot" string="Register lots" type="object"
                                                icon="fa-list"
                                                attrs="{'invisible': [('has_tracking', 'not in', ['lot','serial'])]}"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Miscellaneous">
                                <group>
                                    <group groups="stock.group_stock_multi_locations">
                                        <field name="picking_type_id" attrs="{'readonly': [('has_moves', '=', True)]}"/>
                                        <field name="location_src_id" domain="[('usage','=','internal')]"
                                               attrs="{'readonly': [('has_moves', '=', True)]}"/>
                                        <field name="location_dest_id" domain="[('usage','=','internal')]"
                                               attrs="{'readonly': [('has_moves', '=', True)]}"/>
                                    </group>
                                    <group>
                                        <field name="availability"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>

            </field>
        </record>

        <!-- Inherit Form View to Modify it -->
        <record id="linkloving_mrp_production_form_view_inherit" model="ir.ui.view">
            <field name="name">mrp.production.form</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="linkloving_mrp_extend.linkloving_mrp_production_form_view"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='process_id']" position="after">
                    <field name="production_line_id"
                           attrs="{'readonly': [('state', 'not in', ['confirmed', 'draft', 'waiting_material', 'prepare_material_ing'])]}"/>
                </xpath>
                <xpath expr="//field[@name='bom_id']" position="after">
                    <field name="sale_order_handle_date"/>
                </xpath>
                <xpath expr="//button[@name='button_waiting_material']" position="replace">
                    <field name="planned_start_backup" invisible="1"/>
                    <button type="formview_dialog"
                            name="get_formview"
                            class="oe_highlight"
                            attrs="{'invisible': [('state', 'not in', ('confirmed', 'draft'))]}"
                            context="{'default_production_id': active_id,
                                'production_id': active_id,
                                'default_process_id': process_id,
                                'default_production_line_id': production_line_id,
                                'default_in_charge_id': in_charge_id,
                                'default_planned_start_backup': planned_start_backup,
                                'default_product_qty': product_qty}"
                            string="开始排产"/>
                </xpath>

                <xpath expr="//button[@name='button_action_cancel_confirm']" position="replace">
                    <!-- Add your fields or attributes here -->
                    <button name="action_cancel_plan" type="object" string="取消排产"
                            attrs="{'invisible': [('state', 'not in', ('waiting_material'))]}"
                            confirm="是否取消排产,移出当前产线?"
                    />
                </xpath>


            </field>
        </record>

        <record id="form_plan_mo_wizard" model="ir.ui.view">
            <field name="name">plan.mo.wizard.form</field>
            <field name="model">plan.mo.wizard</field>
            <field name="arch" type="xml">
                <form string="排产">
                    <sheet>
                        <group>
                            <group>
                                <field name="production_id" required="1"/>
                                <field name="process_id" required="1"/>
                                <field name="production_line_id" domain="[('process_id', '=', process_id)]"
                                       required="1"/>
                                <field name="is_priority"/>
                            </group>
                            <group>
                                <field name="product_qty" required="1"/>
                                <field name="planned_start_backup"/>
                                <field name="in_charge_id" required="1"/>
                            </group>
                        </group>

                    </sheet>
                    <!--<footer>-->
                    <!--<button name="arrange" string="排产" type="object" class="btn-primary"/>-->
                    <!--<button string="取消" class="btn-default" special="cancel"/>-->
                    <!--</footer>-->
                </form>

            </field>
        </record>

    </data>
</openerp>