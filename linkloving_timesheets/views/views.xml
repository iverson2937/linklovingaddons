<openerp>
    <data>
        <record id="view_timesheet_partner_tree" model="ir.ui.view">
            <field name="name">linkloving.timesheet.order</field>
            <field name="model">linkloving.timesheet.order</field>
            <field name="arch" type="xml">
                <tree string="工时单" create="0" delete="0">
                    <field name="from_partner"/>
                    <field name="to_partner"/>
                    <field name="work_type_id"/>
                    <field name="hour_spent"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="view_timesheet_partner_form" model="ir.ui.view">
            <field name="name">linkloving.timesheet.order</field>
            <field name="model">linkloving.timesheet.order</field>
            <field name="priority" eval="1"/>
            <field name="arch" type="xml">
                <form string="工时单" create="0" delete="0">
                    <header>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="from_partner" readonly="1"/>
                                <field name="to_partner" required="1" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            </group>
                            <group>
                                <field name="work_type_id"
                                       attrs="{'readonly': [('state', '!=', 'running')],
                             'invisible': [('state','=','draft')],
                             'required': [('state', '=', 'running')]}"/>
                                <field name="hour_spent"
                                       attrs="{'readonly': [('state', '!=', 'running')],
                             'invisible': [('state','=','draft')],
                             'required': [('state', '=', 'running')]}"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>


        <record id="view_assign_timesheet_partner" model="ir.ui.view">
            <field name="name">linkloving.timesheet.order</field>
            <field name="model">linkloving.timesheet.order</field>
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <form string="分配工序负责人">
                    <header>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <group>
                        <group>
                            <field name="from_partner" readonly="1"/>
                            <field name="to_partner" required="1" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        </group>
                        <group>
                            <field name="work_type_id"
                                   attrs="{'readonly': [('state', '!=', 'running')],
                             'invisible': [('state','=','draft')],
                             'required': [('state', '=', 'running')]}"/>
                            <field name="hour_spent"
                                   attrs="{'readonly': [('state', '!=', 'running')],
                             'invisible': [('state','=','draft')],
                             'required': [('state', '=', 'running')]}"/>
                        </group>
                    </group>
                    <footer>
                        <button name="action_assign_partner"
                                string="确定"
                                type="object"
                                default_focus="1"
                                class="oe_highlight"
                                attrs="{'invisible': [('state','!=','draft')]}"/>
                        <button name="action_assign_hour_spent"
                                string="确定"
                                type="object"
                                default_focus="1"
                                class="oe_highlight"
                                attrs="{'invisible': [('state','!=','running')]}"/>

                        <button string="取消" class="oe_link" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Inherit Form View to Modify it -->
        <record id="view_order_form_inherit" model="ir.ui.view">
            <field name="name">sale.order.form.inherit</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='partner_shipping_id']" position="after">
                    <!-- Add your fields or attributes here -->
                    <field name="secondary_operation"/>
                </xpath>

            </field>
        </record>

        <!-- Inherit Form View to Modify it -->
        <record id="view_stock_picking_form_inherit" model="ir.ui.view">
            <field name="name">stock.picking.form</field>
            <field name="model">stock.picking</field>
            <field name="inherit_id" ref="linkloving_stock_picking.view_stock_picking_form"/>
            <field name="arch" type="xml">

                <xpath expr="//button[@name='action_see_move_scrap']" position="before">
                    <button type="object"
                            name="action_view_timesheet_order_ids"
                            class="oe_stat_button"
                            icon="fa-photo fa-image fa-picture-o"
                    >
                        <field name="timesheets_count" widget="statinfo" string="工时单"/>
                    </button>
                </xpath>


                <xpath expr="//button[@name='do_new_transfer']" position="after">
                    <field name="secondary_operation" invisible="1"/>
                    <button name="action_assign_secondary_operation_partner" string="分配二次加工负责人"
                            attrs="{'invisible': ['|', '|',('picking_type_code', '=', 'incoming'),('state','not in',['assigned']),('secondary_operation', '=', False)]}"
                            groups="stock.group_stock_user" type="object" class="oe_highlight"/>

                    <button name="action_view_running_timesheet" string="二次加工完成"
                            attrs="{'invisible': ['|', '|',('picking_type_code', '=', 'incoming'),('state','not in',['secondary_operation']),('secondary_operation', '=', False)]}"
                            groups="stock.group_stock_user" type="object" class="oe_highlight"/>
                    <!-- Add your fields or attributes here -->
                </xpath>

                <xpath expr="//button[@name='do_new_transfer']" position="replace">
                    <button name="do_new_transfer" string="出库调拨"
                            attrs="{'invisible': ['|', '|',('picking_type_code', 'not in', ['outgoing', 'internal']),('state','not in',['assigned']),('secondary_operation', '=', True)]}"
                            groups="stock.group_stock_user" type="object" class="oe_highlight"/>
                    <button name="do_new_transfer" string="出库调拨"
                            attrs="{'invisible': ['|', '|',('picking_type_code', 'not in', ['outgoing', 'internal']),('state','not in',['secondary_operation_done']),('secondary_operation', '=', False)]}"
                            groups="stock.group_stock_user" type="object" class="oe_highlight"/>

                    <!-- Add your fields or attributes here -->
                </xpath>

            </field>

        </record>
    </data>
</openerp>